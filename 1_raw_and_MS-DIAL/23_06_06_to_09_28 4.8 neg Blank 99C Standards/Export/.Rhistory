plot(intensitiesM0_sm)
plot(intensitiesM1_sm)
plot(intensitiesM2_sm)
M2_edgeList
integrated_to_area_list_M2
plot(intensitiesM0_sm)
integrated_to_area_list_M2[24:]
integrated_to_area_list_M2[24:50]
integrated_to_area_list_M2[25:50]
intensitiesM2_sm[25:29]
plot(intensitiesM2_sm[25:29])
plot(intensitiesM0_sm[25:29])
plot(intensitiesM2_sm[25:29])
plot(intensitiesM1_sm[25:29])
plot(intensitiesM2_sm[25:29])
cor(intensitiesM0_sm[25:29], intensitiesM2_sm[25:29], method = "spearman")
plot(intensitiesM2_sm[2:31])
plot(intensitiesM2_sm[2:31]-M2_baseline[2:31])
plot(intensitiesM0_sm[2:31]-M0_baseline[2:31])
M2_noise_180s
M2_baseline
intensitiesM2_sm
intensitiesM2_sm > (M2_baseline + M2_noise_180s)
left_slice_p <- which(M2_edgeList == 1)[1]
right_slice_p <- tail(which(M2_edgeList == 1), n = 1)
data <- intensitiesM2_sm[left_slice_p:right_slice_p] - M2_baseline[left_slice_p:right_slice_p]
reference_shape <- intensitiesM0_sm[left_slice_p:right_slice_p] - M0_baseline[left_slice_p:right_slice_p]
data <- intensitiesM2_sm[21:30] - M2_baseline[21:30]
reference_shape <- intensitiesM0_sm[21:30] - M0_baseline[21:30]
cor(data, reference_shape)
calculate_pearson_cutoff(max(intensitiesM0_sm), M0_noise_180s, max(intensitiesM2_sm), M2_noise_180s)
cor(data, reference_shape, method = "spearman")
calculate_pearson_cutoff(max(intensitiesM0_sm), M0_noise_180s, max(intensitiesM2_sm), M2_noise_180s, method = "spearman")
calculate_pearson_cutoff(max(intensitiesM0_sm), M0_noise_180s, max(intensitiesM2_sm), M2_noise_180s)
intensitiesM2_sm > baseline
intensitiesM2_sm > M2_baseline
intensitiesM2_sm > M2_baseline*1.1
intensitiesM2_sm > M2_baseline*1.3
M2_baseline
intensitiesM2_sm
intensitiesM2_avsm <- smooth_intensities(intensitiesM2)
intensitiesM2_avsm <- smooth_intensities(intensitiesM2, total_slices)
intensitiesM2_avsm
intensitiesM2_avsm - intensitiesM2_sm
intensitiesM2_avsm > baseline
intensitiesM2_avsm > M2_baseline
Parameters for SG filter
# Parameters for SG filter
p <- 3  # Polynomial order
n <- 7  # Window size
# Function to apply SG filter with edge correction
adaptive_sg_filter <- function(data, p, n) {
# Padding data to reduce edge effects
half_window <- floor(n / 2)
padded_data <- c(rep(data[1], half_window), data, rep(data[length(data)], half_window))
# Apply SG filter
smoothed_padded <- sgolayfilt(padded_data, p = p, n = n)
# Remove padding
smoothed <- smoothed_padded[(half_window + 1):(length(smoothed_padded) - half_window)]
# Post-processing to handle negative values
smoothed[smoothed < 0] <- 0
return(smoothed)
}
# Apply the adaptive SG filter
intensitiesM2_adsgsm <- adaptive_sg_filter(intensitiesM2, p, n)
# Display the results
print(intensitiesM2adsg_sm)
# Display the results
print(intensitiesM2_adsg_sm)
print(intensitiesM2_adsgsm)
intensitiesM2_adsgsm > M2_baseline
intensitiesM2_sm > M2_baseline
intensitiesM2_sm
intensitiesM2
M2_edgeList
M2_edgeList[1:31]
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Get_M0M1M2(interval_calculated)_20240606_4.8_ver6_byslice_SGsm_arPLS_3SN&BL_pearson70_1e4threshold_10ppm.R", echo=TRUE)
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Get_M0M1M2(interval_calculated)_20240606_4.8_ver6_byslice_SGsm_arPLS_3SN&BL_pearson70_1e4threshold_10ppm.R", echo=TRUE)
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Check_Single_ Metabolite_20240605.R", echo=TRUE)
plot(intensitiesM0)
plot(intensitiesM1)
plot(intensitiesM2)
plot(intensitiesM0)
plot(intensitiesM1)
plot(intensitiesM2)
M0_edgeList
M1_edgeList
M2_edgeList
M2_edgeList[20:40]
M2_edgeList[11:40]
M2_edgeList[15:40]
M2_edgeList[17:45]
integrated_to_area_list_M0
integrated_to_area_list_M1
integrated_to_area_list_M2
plot(intensitiesM1)
plot(intensitiesM0)
plot(intensitiesM1)
integrated_to_area_list_M1[17:44]
integrated_to_area_list_M1[15:42]
plot(intensitiesM0_sm)
plot(intensitiesM1_sm)
cor(intensitiesM0_sm[17:42], intensitiesM1_sm[17:42])
cor(intensitiesM0_sm[17:42], intensitiesM1_sm[17:42], method = "spearman")
cor(intensitiesM0_sm[17:42], intensitiesM2_sm[17:42], method = "spearman")
cor(intensitiesM0_sm[17:42], intensitiesM2_sm[17:42])
plot(intensitiesM2_sm)
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Check_Single_ Metabolite_20240605.R", echo=TRUE)
plot(intensitiesM0)
plot(intensitiesM1)
plot(intensitiesM2)
plot(correlation_first_part)
correlation_first_part
M0_edgeList
M1_edgeList
plot(intensitiesM0_sm)
plot(intensitiesM1_sm)
plot(intensitiesM2_sm)
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Check_Single_ Metabolite_20240605.R", echo=TRUE)
plot(intensitiesM0_sm)
plot(intensitiesM1_sm)
plot(intensitiesM2_sm)
plot(intensitiesM0_sm, intensitiesM1_sm)
plot(intensitiesM0_sm, intensitiesM2_sm)
plot(log(intensitiesM0_sm), log(intensitiesM2_sm))
plot(log(intensitiesM0_sm), log(intensitiesM1_sm))
M0_edgeList
M1_edgeList[15]
M1_edgeList
M2_edgeList
M2_edgeList[15:45]
plot(intensitiesM0_sm[17:44], intensitiesM2_sm[17:44])
plot(log(intensitiesM0_sm[17:44]), log(intensitiesM2_sm[17:44])
plot(log(intensitiesM0_sm[17:44]), log(intensitiesM2_sm[17:44]))
plot(log(intensitiesM0_sm[17:44]), log(intensitiesM2_sm[17:44]))
cor(log(intensitiesM0_sm[17:44]), log(intensitiesM2_sm[17:44]))
cor(intensitiesM0_sm[17:44], intensitiesM2_sm[17:44])
cor(intensitiesM0_sm[17:44], intensitiesM2_sm[17:44], method="spearman")
cor(log(intensitiesM0_sm[17:44]), log(intensitiesM2_sm[17:44]), method="spearman")
cor(intensitiesM0_sm[16:45], intensitiesM1_sm[16:45], method="spearman")
cor(intensitiesM0_sm[16:45], intensitiesM1_sm[16:45])
cor(log(intensitiesM0_sm[16:45]), log(intensitiesM1_sm[16:45]))
plot(log(intensitiesM0_sm[16:45]), log(intensitiesM1_sm[16:45]))
integrated_to_area_list_M2
integrated_to_area_list_M1
integrated_to_area_list_M1[16:45]
plot(log(intensitiesM0_sm[17:42]), log(intensitiesM1_sm[17:42]))
cor(log(intensitiesM0_sm[17:42]), log(intensitiesM1_sm[17:42]))
cor(log(intensitiesM0_sm[17:42]), log(intensitiesM1_sm[17:42]), method = "spearman")
plot(log(intensitiesM0_sm[17:42]), log(intensitiesM1_sm[17:42]))
plot(intensitiesM0_sm[17:42], intensitiesM1_sm[17:42])
cor(log(intensitiesM0_sm[17:42]), log(intensitiesM1_sm[17:42]))
cor(log(intensitiesM0_sm[17:42]), log(intensitiesM1_sm[17:42]))
cor(intensitiesM0_sm[17:42], intensitiesM1_sm[17:42])
cor(intensitiesM0_sm[17:42], intensitiesM1_sm[17:42])
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Check_Single_ Metabolite_20240605.R", echo=TRUE)
plot(intensitiesM0)
plot(intensitiesM1)
plot(intensitiesM2)
integrated_to_area_list_M2
integrated_to_area_list_M2[20:40]
integrated_to_area_list_M2[25:35]
cor(intensitiesM0_sm[25:29], intensitiesM2_sm[25:29])
cor(intensitiesM0_sm[25:29], intensitiesM2_sm[25:29], method = "spearman")
M2_edgeList
intensitiesM2_sm
M2_noise_180s
M2_baseline
intensitiesM2_sm > M2_baseline*3
intensitiesM2_sm > M2_noise_180s*3
intensitiesM2 > M2_noise_180s*3
intensitiesM2
plot(intensitiesM2_sm)
plot(intensitiesM2)
plot(intensitiesM2_sm)
cor(intensitiesM0_sm[23:30], intensitiesM2_sm[23:30])
cor(intensitiesM0_sm[23:30], intensitiesM2_sm[23:30], method = "spearman")
intensitiesM2_sm > M2_baseline
intensitiesM2 > M2_baseline
cor(intensitiesM0_sm[23:30], intensitiesM2_sm[23:30])
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Check_Single_ Metabolite_20240605.R", echo=TRUE)
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Check_Single_ Metabolite_20240605.R", echo=TRUE)
plot(intensitiesM0)
plot(intensitiesM1)
plot(intensitiesM2)
plot(intensitiesM1)
plot(intensitiesM0)
plot(intensitiesM0_sm)
plot(intensitiesM1_sm)
plot(intensitiesM2_sm)
plot(intensitiesM1_sm)
plot(intensitiesM0_sm)
plot(intensitiesM0)
plot(intensitiesM1)
M0_noise_180s
M1_noise_180s
M1_baseline
intensitiesM1_sm
intensitiesM1
cor(intensitiesM0_sm, intensitiesM1_sm)
M1_edgeList
M1_edgeList[19:30]
M1_edgeList[18:31]
M1_edgeList[15:35]
cor(intensitiesM0_sm[18:31], intensitiesM1_sm[18:31])
cor(intensitiesM0_sm[18:31], intensitiesM1_sm[18:31], method = "spearman")
plot(intensitiesM0_sm)
plot(intensitiesM1_sm)
plot(intensitiesM1)
plot(intensitiesM0)
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Get_M0M1M2(interval_calculated)_20240610_4.8_ver6_byslice_SGsm_arPLS_3SN&BL_pea&spe90_1e4threshold_10ppm_EdgechecksBoth_ct_forloop.R", echo=TRUE)
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Get_M0M1M2(interval_calculated)_20240611_4.8_ver6_byslice_SGsm_arPLS_1.3SN&BL_pea&spe90_1e4threshold_10ppm_EdgechecksBoth_ctsd_rloop.R", echo=TRUE)
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Check_Single_ Metabolite_20240610_pea&spe90_3&1.3_bln_ctsd.R", echo=TRUE)
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Check_Single_ Metabolite_20240610_pea&spe90_3&1.3_bln_ctsd.R", echo=TRUE)
integrated_to_area_list_M2
find_highest_local_max_in_regions(intensitiesM2_sm, positionM2, left_edge_p, right_edge_p)
M2_edgeList
M2_edgeList[20:75]
M2_edgeList[25:73]
M2_edgeList[27:73]
find_highest_local_max_in_regions(intensitiesM2_sm, positionM2, 27, 73)
plot(intensitiesM2_sm)
positionM2
start()
start
check_continuous_values(49, 53, intensitiesM2_sm, M2_baseline)
plot(calculate_first_derivative(intensitiesM2_sm))
plot(calculate_first_derivative(intensitiesM2_sm)[49:53])
plot(calculate_second_derivative(intensitiesM2_sm)[49:53])
plot(calculate_second_derivative(intensitiesM2_sm)[49:53])
(calculate_first_derivative(intensitiesM2_sm)[49:53])
(calculate_second_derivative(intensitiesM2_sm)[49:53])
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Get_M0M1M2(interval_calculated)_20240611_4.8_ver6_byslice_SGsm_arPLS_1.3SN&BL_pea&spe90_1e4threshold_10ppm_EdgeBoth_ctnew_loop.R", echo=TRUE)
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Get_M0M1M2(interval_calculated)_20240612_4.8_ver6_byslice_SGsm_arPLS_1.3SN&BL_pea&spe90_1e4threshold_10ppm_EdgeBoth_ctnew_loop.R", echo=TRUE)
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Get_M0M1M2(interval_calculated)_20240612_4.8_ver6_byslice_SGsm_arPLS_1.3SN&BL_pea&spe90_1e4threshold_10ppm_EdgeBoth_ctnew_loop.R", echo=TRUE)
# Create a new workbook
wb <- createWorkbook()
# Add sheets with data
addWorksheet(wb, "Sheet1")
writeData(wb, "Sheet1", extracted_table)
addWorksheet(wb, "Sheet2")
writeData(wb, "Sheet2", extracted_table2)
# Save the workbook
saveWorkbook(wb, file = output_name, overwrite = TRUE)
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Get_M0M1M2(interval_calculated)_20240612_4.8_ver6_byslice_SGsm_arPLS_1.3SN&BL_pea&spe90_1e4threshold_10ppm_EdgeBoth_ctnew_loop.R", echo=TRUE)
source("C:/Users/zhenw/Marc Hellerstein Lab/Normalized Data/23_06_06_to_09_28 4.8 neg Blank 99C Standards/Export/Get_M0M1M2(interval_calculated)_20240612_4.8_ver6_byslice_SGsm_arPLS_1.3SN&BL_pea&spe90_1e4threshold_10ppm_EdgeBoth_ctnew_loop.R", echo=TRUE)
17.99915961286-15.99491461957
2.004245+88.0391
2.004245+88.0391+13.00335483507-12
massdiffH1H2=2.01410177812-1.00782503223
massdiffC12C13=13.00335483507-12
massdiffN14N15=15.00010889888-14.00307400443
massdiffO16O17=16.99913175650-15.99491461957
massdiffO16O18=17.99915961286-15.99491461957
massdiffS32S33=32.9714589098-31.9720711744
massdiffS32S34=33.967867004-31.9720711744
A ,- 88.039
A <- 88.039
A+massdiffC12C13
A+massdiffC12C13+massdiffO16O18
AmassdiffO16O18
A+massdiffO16O18
L<-130.086
L+massdiffC12C13
L+massdiffO16O18
L+massdiffO16O18+massdiffC12C13
L
# Global constants
massdiffH1H2=2.01410177812-1.00782503223
massdiffC12C13=13.00335483507-12
massdiffN14N15=15.00010889888-14.00307400443
massdiffO16O17=16.99913175650-15.99491461957
massdiffO16O18=17.99915961286-15.99491461957
massdiffS32S33=32.9714589098-31.9720711744
massdiffS32S34=33.967867004-31.9720711744
massdiffC12C13
massdiffN14N15
peak_list <- std_mix_2_msms
peak_list <- "std_mix_2_msms"
library(openxlsx)
current_path <- getwd()
ID_list <- xlsx_data[[peak_list]]
xlsx_data <- read.csv("PeakID_1_2024227148.txt", header = TRUE, sep = "\t")
ID_list <- xlsx_data[[peak_list]]
# Find sample files of the same folder
txt_file_name <- paste0(peak_list, ".txt")
input_file <- read.csv(txt_file_name, header = TRUE, sep = "\t")
txt_data <- input_file[input_file$PeakID %in% ID_list, ]
View(txt_data)
View(input_file)
View(xlsx_data)
View(txt_data)
txt_data[1, "PeakID"]
View(txt_data)
xlsx_data <- read.csv("PeakID_1_2025714159.txt", header = TRUE, sep = "\t")
View(xlsx_data)
xlsx_data <- read.csv("PeakID_1_2025714159.txt", header = FALSE, sep = "\t")
View(xlsx_data)
colnames(xlsx_data) <- as.character(xlsx_data[5, ])
xlsx_data <- xlsx_data[-c(1:5), ]
View(xlsx_data)
View(xlsx_data)
colnames(xlsx_data)
###################################
# File: 1a_Filter_Alignment_PeakID_Info.R
# Input: "PeakID_DateXXX.txt" is the alignment file exported from MS-DIAL ver 4.8,
#         which contains the PeakID information indicating which peaks are the metabolites of interest.
#         If MS-DIAL assigned the wrong peak during group alignment, we can manually correct this text file using excel before importing.
#         "Sample_XXX.txt"  is the sample peak information file
# A MS-DIAL annotation peak list txt file, raw mzML mass spectrometry file
# Output: A csv file of by slice M0 M1 M2 information of all peaks annotated in the input file
# Usage: Shall change input and output file names, mzml file m/z range as needed. Could change m/z ppm window.
# Note: M0 M1 M2 retriveing and prediction algorithm are based on Naveed's codes,
# I wrote the MS-DIAL reading codes, M0 M1 M2 interval prediction, and parameters passing codes
# and used Chat-GPT for codes debugging solutions.
####################################
#Important: change names in line 5,6
library(openxlsx)  # For reading xlsx files
xlsx_name <- "PeakID_1_2025714159"
######################################
# Set working directory to be the current folder
current_path <- getwd()
xlsx_path <- paste0(xlsx_name, ".txt")
xlsx_1a_name <- paste0(xlsx_name, "_1a.txt")
# Load the xlsx/txt file
xlsx_data <- read.csv(xlsx_path, header = FALSE, sep = "\t")
# Set row 5 data as column name and remove the first 4 empty rows. Be Cautious that MS-DIAL versions other than
# ver 4.8 may have a different export file format and requires modification of these codes.
colnames(xlsx_data) <- as.character(xlsx_data[5, ])
xlsx_data <- xlsx_data[-c(1:5), ]
# Remove rows where "Metabolite name" contains "Unknown" or "w/o MS2:"
xlsx_data <- xlsx_data[!grepl("Unknown|w/o MS2:", xlsx_data[["Metabolite name"]]), ]
# Save the new alignment file
write.table(txt_data, file = txt_file_1a_name, sep = "\t", row.names = FALSE)
# Save the new alignment file
write.table(xlsx_data, file = xlsx_1a_name, sep = "\t", row.names = FALSE)
#####################
#IMPORTANT: change names in line 5,6
library(openxlsx)  # For reading xlsx files
# Load the xlsx/txt file
xlsx_data <- read.csv("PeakID_1_2025714159_1a.txt", header = TRUE, sep = "\t")
Peak_list <- c(
"std_mix_1_msms",
"std_mix_2_msms",
"std_mix_3_msms",
"std_mix_4_neg_DDA",
"std_mix_highres"
)
# Sometimes, the MS-DIAL alignment file identify a metabolite with confidence in most samples
# but not in the specific sample this iteration processes. In this condition, we will use "MS1_mz_tolerance"
# to do an additional check to confirm this samples' corresponding peak have similar MS1 m/z with the alignment one.
# "0.005" should be a robust value for Orbitrap
MS1_mz_tolerance <- 0.005
######################################
########################################
# Set working directory to be the current folder
current_path <- getwd()
for (peak_list in Peak_list){
# Find the alignment file columns that match the samples and get the peak ID
ID_list <- xlsx_data[[peak_list]]
# Find sample files of the same folder
txt_file_name <- paste0(peak_list, ".txt")
input_file <- read.csv(txt_file_name, header = TRUE, sep = "\t")
# Filter out sample entries with IDs in alignment peak ID
txt_data <- input_file[input_file$PeakID %in% ID_list, ]
unknown_data <- txt_data[txt_data$Title == "Unknown", ] # Some data of the sample may not be identified with confidence, extract them to do one more check later
txt_data <- txt_data[txt_data$Title != "Unknown", ]
# Iterate through each data row of the txt data
if (nrow(txt_data) > 0) {
for (i in 1:nrow(txt_data)) {
peak_id <- txt_data[i, "PeakID"]
# Find the row in xlsx_data with matching Peak ID
matching_row <- xlsx_data[xlsx_data[[peak_list]] == peak_id, ]
if (nrow(matching_row) > 0) {  # If a match is found
new_name <- matching_row$`Metabolite.name`
txt_data[i, "Title"] <- new_name # Use Alignment metabolite name to replace sample metabolite name for consistency
new_formula <- matching_row$`Formula`
txt_data[i, "Formula"] <- new_formula
}
}
}
if (nrow(unknown_data) > 0) {
for (n in 1:nrow(unknown_data)){
peak_id <- unknown_data[n, "PeakID"]
matching_row <- xlsx_data[xlsx_data[[peak_list]] == peak_id, ]
# Additional check to handle the condition when the alignment file identify a metabolite with confidence in most samples but not the specific sample this iteration processes
if (nrow(matching_row) > 0) {
if (abs(unknown_data$Precursor.m.z[n] - matching_row$Reference.m.z) <= MS1_mz_tolerance){
new_name <- matching_row$`Metabolite.name`
unknown_data[n, "Title"] <- new_name
new_formula <- matching_row$`Formula`
unknown_data[n, "Formula"] <- new_formula
txt_data <- rbind(txt_data, unknown_data[n,])
}
}
}
}
# Save the updated txt data to a new txt file
txt_file_1a_name <- paste0(peak_list, "_1b.txt")
write.table(txt_data, file = txt_file_1a_name, sep = "\t", row.names = FALSE)
}
###################################
# File: 1b_Extract_Metabolites_Identification_Info.R
# Input: "PeakID_DateXXX_1a.txt" is the alignment file exported from MS-DIAL ver 4.8 and has undergo step 1a processing,
#         This "1a" alignment file should have been filtered through codes "1a", and been manually corrected
#         if necessary to correct wrong alignment information given by MS-DIAL
#         "Sample_XXX.txt"  is the sample peak information file exported directly from MS-DIAL ver 4.8
# Function: Based on the correct "PeakID_DateXXX_1a.txt" alignment file, this codes filter and extract metabolites peak
#           identification info from all sample files.
# Output: "Sample_XXX_1b.txt" for each sample that contains the correwct identifciation information such as formula, RT, m/z.
# Usage: Shall change input and output file names, mzml file m/z range as needed. Could change m/z ppm window.
# Next to Do: Manually check the output "Sample_XXX_1b.txt" with excel and do any necessary modifications.
#             For example, if MS-DIAL identify one metabolite peak to be two separated peak, we can manually
#             combine the two peaks row data into one row by updating the left, peak height, and right retention time info
#             we will use this "Sample_XXX_1b.txt" file to do "1c_Extract_Metabolites_M0M1M2_using_Identification.R"
####################################
######################################
#IMPORTANT: change the alignment file name in line 25 and samples name from line 27 to 32
library(openxlsx)  # For reading xlsx files
xlsx_name <- "PeakID_1_2024227148"
Peak_list <- c(
"std_mix_1_msms",
"std_mix_2_msms",
"std_mix_3_msms",
"std_mix_4_neg_DDA",
"std_mix_highres"
)
# Sometimes, the MS-DIAL alignment file identify a metabolite with confidence in most samples
# but not in the specific sample this iteration processes. In this condition, we will use "MS1_mz_tolerance"
# to do an additional check to confirm this samples' corresponding peak have similar MS1 m/z with the alignment one.
# "0.005" should be a robust value for Orbitrap
MS1_mz_tolerance <- 0.005
######################################
########################################
# Set working directory to be the current folder
current_path <- getwd()
# Load the xlsx/txt file
xlsx_1a_name <- paste0(xlsx_name, "_1a.txt")
xlsx_data <- read.csv(xlsx_1a_name, header = TRUE, sep = "\t")
View(xlsx_data)
###################################
# File: 1c_Extract_Metabolites_M0M1M2_using_Identification
# Input: "PeakID_DateXXX.txt" is the alignment file exported from MS-DIAL ver 4.8,
#         which contains the PeakID information indicating which peaks are the metabolites of interest.
#         If MS-DIAL assigned the wrong peak during group alignment, we can manually correct
#         this text file using excel before or after importing.
# Function: Corerct the alignment file format and keep only only identified metabolites in the alignment
# Output: "PeakID_DateXXX_1a.txt" the alignment file that kept only identified metabolites in the correct file format
# Usage: Shall change the alignment file name in line 21
# Next to Do: Manually check the output "PeakID_DateXXX_1a.txt" with excel and do any necessary modifications,
#             we will use this file to do "1b_Extract_Metabolites_Identification_Info.R"
####################################
#####################################
# IMPORTANT: for 1st time usage, please intall the libarary properly
# install.packages("BiocManager")
# BiocManager::install("MSnbase", force = TRUE)
# install.packages("openxlsx")
# install.packages("reticulate")
# install.packages("signal")
library(MSnbase) # To process mzml files
library(openxlsx) # For reading xlsx files
library(reticulate) # For using python files "mida_alg.py" and "numeric_functions.py"
library(signal)  # For Savitzky-Golay smoothing
source("1c_Functions.R")
current_path <- getwd()
source("1c_Functions.R")
###################################
# File: 1c_Extract_Metabolites_M0M1M2_using_Identification
# Input: "PeakID_DateXXX.txt" is the alignment file exported from MS-DIAL ver 4.8,
#         which contains the PeakID information indicating which peaks are the metabolites of interest.
#         If MS-DIAL assigned the wrong peak during group alignment, we can manually correct
#         this text file using excel before or after importing.
# Function: Corerct the alignment file format and keep only only identified metabolites in the alignment
# Output: "PeakID_DateXXX_1a.txt" the alignment file that kept only identified metabolites in the correct file format
# Usage: Shall change the alignment file name in line 21
# Next to Do: Manually check the output "PeakID_DateXXX_1a.txt" with excel and do any necessary modifications,
#             we will use this file to do "1b_Extract_Metabolites_Identification_Info.R"
####################################
#####################################
# IMPORTANT: for 1st time usage, please intall the libarary properly
# install.packages("BiocManager")
# BiocManager::install("MSnbase", force = TRUE)
# install.packages("openxlsx")
# install.packages("reticulate")
# install.packages("signal")
library(MSnbase) # To process mzml files
library(openxlsx) # For reading xlsx files
library(reticulate) # For using python files "mida_alg.py" and "numeric_functions.py"
library(signal)  # For Savitzky-Golay smoothing
current_path <- getwd()
source("1c_Functions.R")
# IMPORTANT: Python needs to be already installed in the computer separately, and then run the following
# three lines with library(reticulate) loaded at the 1st time. Answer "No" for creating default reticulate enviorment
# np <- import("numpy")
# py_install("scipy")
# py_install("pandas")
source_python("numeric_functions.py")
source_python("mida_alg.py") # Two python files from https://github.com/naveedziari/PyMIDA/tree/main/pymida
# but with one line commented out to do Mass Isotopomer Distribution Analysis in R
# IMPORTANT: change the peak file name in following lines
Peak_list <- c(
"std_mix_1_msms",
"std_mix_4_neg_DDA",
"std_mix_highres"
)
mzML_list <- c(
"std_mix_1_msms",
"std_mix_4_neg_DDA",
"std_mix_highres"
)
# IMPORTANT: Tell codes the mass window of the mass spec method in Dalton
mz_total_region <- c(69,360)
